Could possibly use more iterators and less Vec.
